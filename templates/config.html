<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .form-row, .form-group, .border {
            margin-bottom: 1rem;
        }
        .form-group label {
            margin-bottom: 0.5rem;
        }
        .form-control {
            margin-bottom: 0.5rem;
        }
        .btn-block {
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
<div class="d-flex">
    {% include 'left_panel.html' %}
    <div class="right-panel flex-grow-1 p-3">
        <div class="configuration-container">
            <form id="configurationForm" onsubmit="saveRevisionData(event)" class="mb-4">
                <div class="border p-2 mb-2">
                    <h2>References</h2>
                    <div class="form-row p-2 mb-2">
                        <div class="form-group col-md-4">
                            <label for="referenceNumber">Reference Number</label>
                            <input type="text" id="referenceNumber" name="referenceNumber" class="form-control" required>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="documentTitle">Document Title</label>
                            <input type="text" id="documentTitle" name="documentTitle" class="form-control" required>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="documentId">Document ID</label>
                            <input type="text" id="documentId" name="documentId" class="form-control" required>
                        </div>
                    </div>
                </div>
                <div class="border p-2 mb-2">
                    <h2>Document Revision History</h2>
                    <div class="form-row p-2 mb-2">
                        <div class="form col-md-6">
                            <label for="revision">Revision</label>
                            <input type="text" id="revision" name="revision" class="form-control" required>
                        </div>
                        <div class="form col-md-6">
                            <label for="date">Date</label>
                            <input type="date" id="date" name="date" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row p-2 mb-2">
                        <div class="form col-md-6">
                            <label for="author">Author</label>
                            <input type="text" id="author" name="author" class="form-control" required>
                        </div>
                        <div class="form col-md-6">
                            <label for="attendees">Attendees</label>
                            <textarea id="attendees" name="attendees" class="form-control" required></textarea>
                        </div>
                    </div>
                </div>
                <div class="border p-2 mb-2">
                    <h2>Terminology & Abbreviations</h2>
                    <div class="form-row mb-2">
                        <div class="col-md-5">
                            <input type="text" id="term" placeholder="Term" class="form-control">
                        </div>
                        <div class="col-md-5">
                            <input type="text" id="abbreviation" placeholder="Abbreviation" class="form-control">
                        </div>
                        <div class="col-md-2">
                            <button type="button" onclick="addTerm()" class="form-control btn btn-primary">Add</button>
                        </div>
                    </div>
                    <ul id="termList" class="list-group mb-2"></ul>
                </div>
                <div class="text-center">
                    <button type="submit" class="btn btn-primary">Save Configuration</button>
                </div>
            </form>
        </div>
        <div class="footer mt-2 badge-dark">
            <p>&copy; 2024 PHDSI - HSCS. All rights reserved.</p>
        </div>
    </div>
</div>

<script>
    function loadContent(url) {
        fetch(url)
            .then(response => response.text())
            .then(data => {
                document.querySelector('.right-panel').innerHTML = data;
            })
            .catch(error => console.error('Error loading content:', error));
    }

    function addTerm() {
        const term = document.getElementById('term').value;
        const abbreviation = document.getElementById('abbreviation').value;

        if (term.trim() && abbreviation.trim()) {
            const li = document.createElement('li');
            li.textContent = `${term}: ${abbreviation}`;
            li.className = 'list-group-item';
            document.getElementById('termList').appendChild(li);

            document.getElementById('term').value = '';
            document.getElementById('abbreviation').value = '';
        } else {
            alert('Please fill in both fields.');
        }
    }

    function saveRevisionData(event) {
        event.preventDefault();

        const formData = new FormData(document.getElementById('configurationForm'));
        const termList = document.getElementById('termList').children;
        const terms = [];
        for (let i = 0; i < termList.length; i++) {
            terms.push(termList[i].textContent);
        }
        formData.append('terms', JSON.stringify(terms));

        fetch('/save_revision_data', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Data saved successfully');
                } else {
                    alert('Failed to save data');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while saving data');
            });
    }
</script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>